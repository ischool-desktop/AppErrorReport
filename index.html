<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta charset="utf-8">
	<style>
		.collapse {
			border-collapse: collapse;
			border: 1px solid gray;
		}
		.cell {
		    padding: 5px;
		    border: 1px solid gray;
		}
		.mi {
			cursor : pointer;
			background-color: lightblue;
		}

		.menu {
			width:32px;
			height:32px;
			background-image: url(http://icons.iconarchive.com/icons/mcdo-design/aqua-candy/128/Find-icon.png);
			background-size:contain;
		}

		.menuarea {
			border: 1px solid lightgray;
			padding: 16px;
		}

		.find {
			background-image: url(http://icons.iconarchive.com/icons/mcdo-design/aqua-candy/128/Find-icon.png)
		}

	</style>
	<script   src="https://code.jquery.com/jquery-2.2.4.min.js"   integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="   crossorigin="anonymous"></script>
	<script>

		var currentDataSet = [];

		var getData = function() {
			$('#loadingImg').css('visibility','visible');
			//var targeturl = "https://devg.ischool.com.tw/dsa/dev.sh_d/1campus.mobile.debug/GetMessages?rsptype=json";
			var record_count = document.getElementById('record_count').value ;
			var targeturl = "https://devg.ischool.com.tw/dsa/dev.sh_d/1campus.mobile.debug/test?rsptype=json&stt=public&content=%3CRecordCount%3E" + record_count + "%3C/RecordCount%3E";

			$.get(targeturl, function(data) {
				$('#loadingImg').css('visibility','hidden');
				currentDataSet = data ;
				showData();
			});
		}

		var showData = function() {
			var data = currentDataSet ;
			$("#content").html('');
			console.log(data.Response);
				
			$(data.Trace).each(function(index, ex) {
				if (isValidEx(ex)) {
					var html = ["<tr id='", ex.Uid, "'>"].join("");
					html += ["<td class='cell'>", ex.uid, "</td>"].join("");
					html += ["<td class='cell'>", ex.last_update, "</td>"].join("");
					html += ["<td class='cell'>", ex.user_id, "</td>"].join("");
					html += ["<td class='cell'>", ex.remark, "</td>"].join("");
					html += ["<td class='cell'>", ex.target_dsns, "</td>"].join("");
					html += ["<td class='cell'>", ex.platform, "</td>"].join("");
					html += ["<td class='cell'>", ex.sdk_no, "</td>"].join("");
					html += ["<td class='cell' style='width:200px'>", ex.localize_message, "</td>"].join("");
					html += ["<td class='cell'>", ex.module_name, "</td>"].join("");
					html += ["<td class='cell'>", ex.targetUser_id, "</td>"].join("");
					html += ["<td class='cell'>", ex.targetUser_name, "</td>"].join("");
					html += ["<td class='cell'>", ex.manufactory, "</td>"].join("");
					html += ["<td class='cell'>", ex.device_odel, "</td>"].join("");
					html += ["<td class='cell'>", ex.app_package, "</td>"].join("");
					html += ["<td class='cell'>", ex.ap_version, "</td>"].join("");
					html += "</tr>";
					$(html).click(function() {
						$('#detail_' + ex.uid).toggle('fast') ;
					}).mouseover(function() {
						$(this).addClass('mi');
					}).mouseout(function() {
						$(this).removeClass('mi');
					}).appendTo("#content");

					var html2 = ["<tr id='detail_", ex.uid, "'><td  class='cell' colspan='13'><pre>", ex.callstack , "</pre></td></tr><tr>"].join("");

					$(html2).appendTo("#content").hide();
				}
				
			});
		}

		var isValidEx = function(ex) {
			var cbContract = document.getElementById("cbContract") ;
			var isContractNotFound = (ex.callstack.indexOf(cbContract.value) > -1) ;

			if (cbContract.checked && isContractNotFound) {
				return true ;
			}

			var cbUser = document.getElementById("cbUser") ;
			var isUserNotExist = (ex.callstack.indexOf(cbUser.value) > -1) ;
			if (cbUser.checked && isUserNotExist) {
				return true ;
			}

			var cbOthers = document.getElementById("cbOthers") ;
			if (cbOthers.checked && (!isContractNotFound) && (!isUserNotExist)) {
				return true ;
			}
			else
				return false 

		};

		$(document).ready(function() {
			$('#menu').hide();
			getData();
		});

	</script>
</head>
<body>
<div class="menu" onclick="$('#menu').toggle('fast');" onmouseover="$(this).addClass('mi');"  onmouseout="$(this).removeClass('mi');"></div>
<div id="menu" class="menuarea">
	<input type="number" id="record_count" value="300" />
	<button class="find" onclick="getData();">取得</button>
	<img src="http://www.regalhotel.com/hotels-themes/images/common/loading.gif" id="loadingImg" style="display:hidden;"/>
	<label><input type="checkbox" id="cbContract" onchange="showData();" value="Contract Not found"> Contract Not found</label>
	<label><input type="checkbox" id="cbUser" onchange="showData();" value="User doesn't exist"> User doesn't exist</label>
	<label><input type="checkbox" id="cbOthers" onchange="showData();" value="others" checked="true"> Others </label>
</div>
<table class="collapse">
<thead>
	<td>Uid</td>
	<td>LastUpdate</td>
	<td>UserID</td>
	<td style="width:100px">Remark</td>
	<td>TargetDSNS</td>
	<td>Platform</td>
	<td>SDK</td>
	<td style="width:200px">LocalizeMessage</td>
	<td>ModuleName</td>
	<td>TargetUserID</td>
	<td>TargetUserName</td>
	<td>Manufactory</td>
	<td>DeviceModel</td>
	<td>AppPackage</td>
	<td>版本</td>
</thead>

<tbody id="content">
	
</tbody>
</table>

</body>
</html>
